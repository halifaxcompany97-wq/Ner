<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
    .container { max-width:400px; margin:auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    h2 { text-align:center; }
    input, button { width:100%; margin:8px 0; padding:10px; font-size:16px; border:1px solid #333; border-radius:5px; }
    button { background:black; color:white; font-weight:bold; cursor:pointer; }
    .message { margin-top:10px; padding:10px; border-radius:6px; font-size:14px; }
    .error { background:#f8d7da; color:#721c24; }
    .success { background:#d4edda; color:#155724; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin Panel</h2>

    <!-- Username is fixed -->
    <p><b>Managing user:</b> <span id="usernameDisplay">user</span></p>

    <input type="number" id="amount" placeholder="Enter amount to add">
    <button id="addBalanceBtn">Add Balance</button>
    <div id="message"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc, setDoc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ✅ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBT-uB0tNUGOZGC8V2I4iP8QUXbXOHu44I",
      authDomain: "newbie-d6a5c.firebaseapp.com",
      projectId: "newbie-d6a5c",
      storageBucket: "newbie-d6a5c.appspot.com", // fixed bucket name
      messagingSenderId: "931411577096",
      appId: "1:931411577096:web:8380459a4564c83ff8c4bd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 🔹 Fixed username
    const username = "user";
    document.getElementById("usernameDisplay").textContent = username;

    const amountInput = document.getElementById("amount");
    const addBalanceBtn = document.getElementById("addBalanceBtn");
    const messageEl = document.getElementById("message");

    function showMessage(text, type="success") {
      messageEl.textContent = text;
      messageEl.className = "message " + type;
    }

    addBalanceBtn.addEventListener("click", async () => {
      const amount = parseFloat(amountInput.value);

      if (isNaN(amount) || amount <= 0) {
        showMessage("⚠️ Please enter a valid amount.", "error");
        return;
      }

      try {
        const ref = doc(db, "users", username);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
          await setDoc(ref, { earnings: amount, pin: "" });
          showMessage(`✅ Created user '${username}' with balance $${amount}.`);
        } else {
          const current = snap.data().earnings || 0;
          const newBalance = current + amount;
          await updateDoc(ref, { earnings: newBalance });
          showMessage(`✅ Added $${amount}. New balance: $${newBalance}.`);
        }
      } catch (err) {
        console.error("❌ Firestore error:", err);
        showMessage("❌ " + err.message, "error");
      }
    });
  </script>
</body>
</html>